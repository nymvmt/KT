<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©”ì´í”ŒìŠ¤í† ë¦¬ í”Œë ˆì´ì–´ ê´€ë¦¬</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-users"></i> ë©”ì´í”ŒìŠ¤í† ë¦¬ í”Œë ˆì´ì–´ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <p>í”Œë ˆì´ì–´ì™€ ì¸ë²¤í† ë¦¬ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì„¸ìš”</p>
        </div>

        <div class="nav-links">
            <a href="/"><i class="fas fa-store"></i> ë¬´ê¸°ìƒì </a>
            <a href="/player.html" class="active"><i class="fas fa-user"></i> í”Œë ˆì´ì–´ ê´€ë¦¬</a>
        </div>

        <div class="player-grid" id="playerGrid">
            <!-- í”Œë ˆì´ì–´ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>

        <div class="inventory-section">
            <div class="inventory-header">
                <h3 class="inventory-title"><i class="fas fa-backpack"></i> ì¸ë²¤í† ë¦¬ ê´€ë¦¬</h3>
                <div class="inventory-info">
                    <span id="selectedPlayerInfo">í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”</span>
                </div>
            </div>

            <div class="inventory-grid" id="inventoryGrid">
                <!-- ì¸ë²¤í† ë¦¬ ìŠ¬ë¡¯ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>

            <div class="controls">
                <div class="control-group">
                    <div class="control-title"><i class="fas fa-user-plus"></i> í”Œë ˆì´ì–´ ìƒì„±</div>
                    <div class="form-group">
                        <label for="newPlayerName"><i class="fas fa-tag"></i> ì´ë¦„:</label>
                        <input type="text" id="newPlayerName" placeholder="í”Œë ˆì´ì–´ ì´ë¦„" required>
                    </div>
                    <div class="form-group">
                        <label for="newPlayerJob"><i class="fas fa-briefcase"></i> ì§ì—…:</label>
                        <select id="newPlayerJob" required>
                            <option value="">ì§ì—… ì„ íƒ</option>
                            <option value="ì „ì‚¬">âš”ï¸ ì „ì‚¬</option>
                            <option value="ê¶ìˆ˜">ğŸ¹ ê¶ìˆ˜</option>
                            <option value="ë§ˆë²•ì‚¬">ğŸ”® ë§ˆë²•ì‚¬</option>
                        </select>
                    </div>
                    <button class="btn btn-success" onclick="createPlayer()" id="createPlayerBtn">
                        <i class="fas fa-plus"></i> í”Œë ˆì´ì–´ ìƒì„±
                    </button>
                </div>

                <div class="control-group">
                    <div class="control-title"><i class="fas fa-cogs"></i> í”Œë ˆì´ì–´ ê´€ë¦¬</div>
                    <div class="form-group">
                        <label for="playerId"><i class="fas fa-id-card"></i> í”Œë ˆì´ì–´ ID:</label>
                        <input type="number" id="playerId" placeholder="í”Œë ˆì´ì–´ ID" min="1">
                    </div>
                    <div class="action-buttons">
                        <button class="btn" onclick="getPlayer()" title="í”Œë ˆì´ì–´ ì •ë³´ ì¡°íšŒ">
                            <i class="fas fa-search"></i> ì¡°íšŒ
                        </button>
                        <button class="btn btn-secondary" onclick="gainExp()" title="ê²½í—˜ì¹˜ 50 íšë“">
                            <i class="fas fa-star"></i> ê²½í—˜ì¹˜ íšë“
                        </button>
                        <button class="btn btn-secondary" onclick="gainMeso()" title="ë©”ì†Œ 1000 íšë“">
                            <i class="fas fa-coins"></i> ë©”ì†Œ íšë“
                        </button>
                        <button class="btn btn-danger" onclick="deletePlayer()" title="í”Œë ˆì´ì–´ ì‚­ì œ">
                            <i class="fas fa-trash"></i> ì‚­ì œ
                        </button>
                    </div>
                </div>
            </div>

            <div id="message"></div>
            <div id="itemDetails" class="item-details" style="display: none;">
                <!-- ì•„ì´í…œ ìƒì„¸ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script>
        let currentPlayer = null;
        let players = [];

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            loadPlayers();
            setupFormValidation();
        });

        // í¼ ìœ íš¨ì„± ê²€ì‚¬ ì„¤ì •
        function setupFormValidation() {
            const nameInput = document.getElementById('newPlayerName');
            const jobSelect = document.getElementById('newPlayerJob');
            const createBtn = document.getElementById('createPlayerBtn');

            function validateCreateForm() {
                const isValid = nameInput.value.trim() && jobSelect.value;
                createBtn.disabled = !isValid;
            }

            nameInput.addEventListener('input', validateCreateForm);
            jobSelect.addEventListener('change', validateCreateForm);
        }

        // í”Œë ˆì´ì–´ ëª©ë¡ ë¡œë“œ
        async function loadPlayers() {
            try {
                showLoadingMessage('í”Œë ˆì´ì–´ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
                const response = await fetch('/api/player');
                if (!response.ok) throw new Error('ì„œë²„ ì˜¤ë¥˜');
                
                players = await response.json();
                displayPlayers();
                hideMessage();
            } catch (error) {
                showMessage('í”Œë ˆì´ì–´ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // í”Œë ˆì´ì–´ ëª©ë¡ í‘œì‹œ
        function displayPlayers() {
            const playerGrid = document.getElementById('playerGrid');
            playerGrid.innerHTML = '';

            if (players.length === 0) {
                playerGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--maple-light);">
                        <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3>í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ìƒˆë¡œìš´ í”Œë ˆì´ì–´ë¥¼ ìƒì„±í•´ë³´ì„¸ìš”!</p>
                    </div>
                `;
                return;
            }

            players.forEach(player => {
                const playerCard = createPlayerCard(player);
                playerGrid.appendChild(playerCard);
            });
        }

        // í”Œë ˆì´ì–´ ì¹´ë“œ ìƒì„±
        function createPlayerCard(player) {
            const card = document.createElement('div');
            card.className = 'player-card';
            card.onclick = () => selectPlayer(player);

            const expPercentage = (player.exp / player.maxExp) * 100;
            const jobIcon = getJobIcon(player.job);
            const levelColor = getLevelColor(player.level);

            card.innerHTML = `
                <div class="player-info">
                    <div class="player-name">${jobIcon} ${player.name}</div>
                    <div class="player-job ${levelColor}">${player.job} Lv.${player.level}</div>
                    <div class="exp-bar">
                        <div class="exp-fill" style="width: ${expPercentage}%"></div>
                        <span class="exp-text">${player.exp}/${player.maxExp}</span>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">HP</div>
                        <div class="stat-value">${player.hp}/${player.maxHp}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">MP</div>
                        <div class="stat-value">${player.mp}/${player.maxMp}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">í˜</div>
                        <div class="stat-value">${player.strength}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ë¯¼ì²©</div>
                        <div class="stat-value">${player.dexterity}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ì§€ëŠ¥</div>
                        <div class="stat-value">${player.intelligence}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">í–‰ìš´</div>
                        <div class="stat-value">${player.luck}</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <div style="font-size: 18px; font-weight: bold; color: var(--maple-yellow);">
                        <i class="fas fa-coins"></i> ${player.meso.toLocaleString()} ë©”ì†Œ
                    </div>
                </div>
                <div class="player-actions">
                    <button class="btn btn-sm" onclick="event.stopPropagation(); selectPlayer(${player.id})" title="ì„ íƒ">
                        <i class="fas fa-check"></i>
                    </button>
                    <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); gainExpForPlayer(${player.id})" title="ê²½í—˜ì¹˜ íšë“">
                        <i class="fas fa-star"></i>
                    </button>
                    <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); gainMesoForPlayer(${player.id})" title="ë©”ì†Œ íšë“">
                        <i class="fas fa-coins"></i>
                    </button>
                </div>
            `;

            return card;
        }

        // ì§ì—… ì•„ì´ì½˜ ë°˜í™˜
        function getJobIcon(job) {
            const icons = {
                'ì „ì‚¬': 'âš”ï¸',
                'ê¶ìˆ˜': 'ğŸ¹',
                'ë§ˆë²•ì‚¬': 'ğŸ”®'
            };
            return icons[job] || 'ğŸ‘¤';
        }

        // ë ˆë²¨ë³„ ìƒ‰ìƒ ë°˜í™˜
        function getLevelColor(level) {
            if (level >= 100) return 'legendary';
            if (level >= 50) return 'epic';
            if (level >= 20) return 'rare';
            return 'common';
        }

        // í”Œë ˆì´ì–´ ì„ íƒ
        function selectPlayer(player) {
            if (typeof player === 'number') {
                // IDë¡œ í”Œë ˆì´ì–´ ì°¾ê¸°
                player = players.find(p => p.id === player);
                if (!player) return;
            }

            currentPlayer = player;
            document.getElementById('selectedPlayerInfo').innerHTML = `
                <i class="fas fa-user"></i> ${player.name} (${player.job} Lv.${player.level})
            `;
            document.getElementById('playerId').value = player.id;
            displayInventory(player.inventory);
            
            showMessage(`${player.name} í”Œë ˆì´ì–´ë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        // ì¸ë²¤í† ë¦¬ í‘œì‹œ
        function displayInventory(inventory) {
            const inventoryGrid = document.getElementById('inventoryGrid');
            inventoryGrid.innerHTML = '';

            for (let i = 0; i < inventory.maxSize; i++) {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot';
                slot.onclick = () => showItemDetails(i, inventory);

                if (i < inventory.slots.length && inventory.slots[i].item) {
                    slot.classList.add('filled');
                    const item = inventory.slots[i].item;
                    const itemIcon = getItemIcon(item.itemType);
                    
                    slot.innerHTML = `
                        <div class="item-icon">${itemIcon}</div>
                        <div class="item-name">${item.name.substring(0, 4)}</div>
                        <div class="item-quantity">${inventory.slots[i].quantity}</div>
                    `;
                    
                    // ì•„ì´í…œ í¬ê·€ë„ì— ë”°ë¥¸ í…Œë‘ë¦¬ ìƒ‰ìƒ
                    const rarityClass = getRarityClass(item.attackPower);
                    slot.classList.add(rarityClass);
                } else {
                    slot.innerHTML = `<i class="fas fa-plus" style="opacity: 0.3;"></i>`;
                }

                inventoryGrid.appendChild(slot);
            }
        }

        // ì•„ì´í…œ ìƒì„¸ ì •ë³´ í‘œì‹œ
        function showItemDetails(slotIndex, inventory) {
            if (slotIndex >= inventory.slots.length || !inventory.slots[slotIndex].item) {
                return;
            }

            const slot = inventory.slots[slotIndex];
            const item = slot.item;
            const itemDetails = document.getElementById('itemDetails');

            itemDetails.innerHTML = `
                <h4><i class="fas fa-info-circle"></i> ${item.name}</h4>
                <p><strong>ì„¤ëª…:</strong> ${item.description}</p>
                <div class="item-stats">
                    <div class="item-stat">
                        <div style="font-size: 12px; color: #666;">íƒ€ì…</div>
                        <div style="font-weight: bold;">${getItemIcon(item.itemType)} ${item.itemType}</div>
                    </div>
                    <div class="item-stat">
                        <div style="font-size: 12px; color: #666;">ê³µê²©ë ¥</div>
                        <div style="font-weight: bold;">${item.attackPower}</div>
                    </div>
                    <div class="item-stat">
                        <div style="font-size: 12px; color: #666;">ìš”êµ¬ë ˆë²¨</div>
                        <div style="font-weight: bold;">${item.requiredLevel}</div>
                    </div>
                    <div class="item-stat">
                        <div style="font-size: 12px; color: #666;">ê°€ê²©</div>
                        <div style="font-weight: bold;">${item.price.toLocaleString()} ë©”ì†Œ</div>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <button class="btn btn-danger" onclick="useItem(${slotIndex})" title="ì•„ì´í…œ ì‚¬ìš©">
                        <i class="fas fa-hand-holding"></i> ì‚¬ìš©
                    </button>
                    <button class="btn btn-secondary" onclick="removeItem(${slotIndex})" title="ì•„ì´í…œ ì œê±°">
                        <i class="fas fa-minus"></i> ì œê±°
                    </button>
                </div>
            `;

            itemDetails.style.display = 'block';
        }

        // ì•„ì´í…œ ì•„ì´ì½˜ ë°˜í™˜
        function getItemIcon(itemType) {
            const icons = {
                'í•œì†ê²€': 'âš”ï¸',
                'í™œ': 'ğŸ¹',
                'ì§€íŒ¡ì´': 'ğŸ”®',
                'ì†Œë¹„ì•„ì´í…œ': 'ğŸ§ª'
            };
            return icons[itemType] || 'ğŸ“¦';
        }

        // í¬ê·€ë„ í´ë˜ìŠ¤ ë°˜í™˜
        function getRarityClass(attackPower) {
            if (attackPower >= 100) return 'legendary';
            if (attackPower >= 50) return 'epic';
            if (attackPower >= 20) return 'rare';
            return 'common';
        }

        // í”Œë ˆì´ì–´ ìƒì„±
        async function createPlayer() {
            const name = document.getElementById('newPlayerName').value.trim();
            const job = document.getElementById('newPlayerJob').value;

            if (!name) {
                showMessage('í”Œë ˆì´ì–´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }
            if (!job) {
                showMessage('ì§ì—…ì„ ì„ íƒí•˜ì„¸ìš”.', 'error');
                return;
            }

            try {
                showLoadingMessage('í”Œë ˆì´ì–´ë¥¼ ìƒì„±í•˜ëŠ” ì¤‘...');
                const response = await fetch('/api/player', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, job })
                });

                if (response.ok) {
                    showMessage(`${name} í”Œë ˆì´ì–´ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
                    document.getElementById('newPlayerName').value = '';
                    document.getElementById('newPlayerJob').value = '';
                    loadPlayers();
                } else {
                    const errorData = await response.json();
                    showMessage(`í”Œë ˆì´ì–´ ìƒì„± ì‹¤íŒ¨: ${errorData.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`, 'error');
                }
            } catch (error) {
                showMessage('í”Œë ˆì´ì–´ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // í”Œë ˆì´ì–´ ì¡°íšŒ
        async function getPlayer() {
            const playerId = document.getElementById('playerId').value;
            if (!playerId) {
                showMessage('í”Œë ˆì´ì–´ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            try {
                showLoadingMessage('í”Œë ˆì´ì–´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
                const response = await fetch(`/api/player/${playerId}`);
                if (response.ok) {
                    const player = await response.json();
                    selectPlayer(player);
                    showMessage('í”Œë ˆì´ì–´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.', 'success');
                } else {
                    showMessage('í”Œë ˆì´ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                showMessage('í”Œë ˆì´ì–´ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ê²½í—˜ì¹˜ íšë“
        async function gainExp() {
            const playerId = document.getElementById('playerId').value;
            if (!playerId) {
                showMessage('í”Œë ˆì´ì–´ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            await gainExpForPlayer(playerId);
        }

        // íŠ¹ì • í”Œë ˆì´ì–´ ê²½í—˜ì¹˜ íšë“
        async function gainExpForPlayer(playerId) {
            try {
                showLoadingMessage('ê²½í—˜ì¹˜ë¥¼ íšë“í•˜ëŠ” ì¤‘...');
                const response = await fetch(`/api/player/${playerId}/exp?expAmount=50`, {
                    method: 'POST'
                });

                if (response.ok) {
                    showMessage('ê²½í—˜ì¹˜ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤! (+50)', 'success');
                    loadPlayers();
                    if (currentPlayer && currentPlayer.id == playerId) {
                        getPlayer();
                    }
                } else {
                    showMessage('ê²½í—˜ì¹˜ íšë“ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                showMessage('ê²½í—˜ì¹˜ íšë“ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë©”ì†Œ íšë“
        async function gainMeso() {
            const playerId = document.getElementById('playerId').value;
            if (!playerId) {
                showMessage('í”Œë ˆì´ì–´ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            await gainMesoForPlayer(playerId);
        }

        // íŠ¹ì • í”Œë ˆì´ì–´ ë©”ì†Œ íšë“
        async function gainMesoForPlayer(playerId) {
            try {
                showLoadingMessage('ë©”ì†Œë¥¼ íšë“í•˜ëŠ” ì¤‘...');
                const response = await fetch(`/api/player/${playerId}/meso?amount=1000`, {
                    method: 'POST'
                });

                if (response.ok) {
                    showMessage('ë©”ì†Œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤! (+1,000)', 'success');
                    loadPlayers();
                    if (currentPlayer && currentPlayer.id == playerId) {
                        getPlayer();
                    }
                } else {
                    showMessage('ë©”ì†Œ íšë“ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                showMessage('ë©”ì†Œ íšë“ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // í”Œë ˆì´ì–´ ì‚­ì œ
        async function deletePlayer() {
            const playerId = document.getElementById('playerId').value;
            if (!playerId) {
                showMessage('í”Œë ˆì´ì–´ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            const player = players.find(p => p.id == playerId);
            if (!player) {
                showMessage('í”Œë ˆì´ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            if (!confirm(`ì •ë§ë¡œ "${player.name}" í”Œë ˆì´ì–´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                return;
            }

            try {
                showLoadingMessage('í”Œë ˆì´ì–´ë¥¼ ì‚­ì œí•˜ëŠ” ì¤‘...');
                const response = await fetch(`/api/player/${playerId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showMessage(`"${player.name}" í”Œë ˆì´ì–´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                    document.getElementById('playerId').value = '';
                    currentPlayer = null;
                    document.getElementById('selectedPlayerInfo').innerHTML = 'í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”';
                    document.getElementById('inventoryGrid').innerHTML = '';
                    document.getElementById('itemDetails').style.display = 'none';
                    loadPlayers();
                } else {
                    showMessage('í”Œë ˆì´ì–´ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                showMessage('í”Œë ˆì´ì–´ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ì•„ì´í…œ ì‚¬ìš©
        async function useItem(slotIndex) {
            if (!currentPlayer) {
                showMessage('í”Œë ˆì´ì–´ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.', 'error');
                return;
            }

            try {
                showLoadingMessage('ì•„ì´í…œì„ ì‚¬ìš©í•˜ëŠ” ì¤‘...');
                const response = await fetch(`/api/player/${currentPlayer.id}/inventory/use/${slotIndex}`, {
                    method: 'POST'
                });

                if (response.ok) {
                    showMessage('ì•„ì´í…œì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤!', 'success');
                    getPlayer();
                } else {
                    showMessage('ì•„ì´í…œ ì‚¬ìš©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                showMessage('ì•„ì´í…œ ì‚¬ìš© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ì•„ì´í…œ ì œê±°
        async function removeItem(slotIndex) {
            if (!currentPlayer) {
                showMessage('í”Œë ˆì´ì–´ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.', 'error');
                return;
            }

            try {
                showLoadingMessage('ì•„ì´í…œì„ ì œê±°í•˜ëŠ” ì¤‘...');
                const response = await fetch(`/api/player/${currentPlayer.id}/inventory/items/${slotIndex}?quantity=1`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showMessage('ì•„ì´í…œì„ ì œê±°í–ˆìŠµë‹ˆë‹¤!', 'success');
                    getPlayer();
                } else {
                    showMessage('ì•„ì´í…œ ì œê±°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                showMessage('ì•„ì´í…œ ì œê±° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë¡œë”© ë©”ì‹œì§€ í‘œì‹œ
        function showLoadingMessage(message) {
            const messageDiv = document.getElementById('message');
            messageDiv.className = 'message';
            messageDiv.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${message}`;
            messageDiv.style.display = 'block';
        }

        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = message;
            messageDiv.style.display = 'block';

            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
        function hideMessage() {
            const messageDiv = document.getElementById('message');
            messageDiv.style.display = 'none';
        }
    </script>

    <style>
        /* í”Œë ˆì´ì–´ ê´€ë¦¬ ì „ìš© ìŠ¤íƒ€ì¼ */
        .player-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .player-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .player-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--maple-orange), var(--maple-gold), var(--maple-green));
        }

        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            border-color: var(--maple-blue);
        }

        .player-info {
            margin-bottom: 20px;
            text-align: center;
        }

        .player-name {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--maple-yellow);
        }

        .player-job {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .player-job.legendary { color: #ff6b35; }
        .player-job.epic { color: #9b59b6; }
        .player-job.rare { color: #3498db; }
        .player-job.common { color: #95a5a6; }

        .exp-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 25px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 15px;
            position: relative;
        }

        .exp-fill {
            background: linear-gradient(90deg, var(--maple-yellow), var(--maple-orange));
            height: 100%;
            transition: width 0.3s ease;
        }

        .exp-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
            display: block;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--maple-yellow);
        }

        .player-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 15px;
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .inventory-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .inventory-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--maple-blue);
        }

        .inventory-info {
            color: var(--maple-light);
            font-size: 1rem;
            font-weight: 600;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 8px;
            margin-bottom: 25px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .inventory-slot {
            width: 55px;
            height: 55px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            font-size: 0.8rem;
        }

        .inventory-slot:hover {
            border-color: var(--maple-blue);
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.1);
        }

        .inventory-slot.filled {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-color: var(--maple-blue);
        }

        .inventory-slot.legendary { border-color: #ff6b35; }
        .inventory-slot.epic { border-color: #9b59b6; }
        .inventory-slot.rare { border-color: #3498db; }
        .inventory-slot.common { border-color: #95a5a6; }

        .item-icon {
            font-size: 1.2rem;
            margin-bottom: 2px;
        }

        .item-name {
            font-size: 0.7rem;
            text-align: center;
            line-height: 1;
            margin-bottom: 2px;
        }

        .item-quantity {
            position: absolute;
            bottom: 2px;
            right: 2px;
            font-size: 0.7rem;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 1px 3px;
            border-radius: 3px;
            font-weight: 600;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .control-group {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-title {
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--maple-yellow);
            font-size: 1.1rem;
            text-align: center;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .item-details {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            margin-top: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .item-details h4 {
            margin-top: 0;
            color: var(--maple-yellow);
            font-size: 1.3rem;
            margin-bottom: 15px;
        }

        .item-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .item-stat {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .player-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            .inventory-grid {
                grid-template-columns: repeat(8, 1fr);
            }
            
            .inventory-slot {
                width: 45px;
                height: 45px;
            }
        }
    </style>
</body>
</html>
